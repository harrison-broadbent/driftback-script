var Driftback=(function(u){"use strict";const c="https://driftback.app",f="/api/v1/surveys";function h(n,r,a,i){const o=`/${encodeURIComponent(n)}/surveys/${encodeURIComponent(r)}/embed`,e=new URL(window.location.href);e.search="";const t=new URL(o,c);return t.searchParams.set("email",a),t.searchParams.set("metadata",JSON.stringify(i)),t.searchParams.set("url",e),t.toString()}function p(n,r){const a=new URL(f,c),i=new URL(window.location.href);return i.search="",a.searchParams.set("project_id",n),a.searchParams.set("email",r),a.searchParams.set("url",i),a.toString()}function b(){const n=t=>{try{return JSON.parse(t)}catch{return t}},r=document.currentScript||document.querySelector("script[data-driftback-project-id],script[data-driftback-email]"),a={projectId:null,email:null,metadata:{}};if(!r)return a;const i=r.getAttribute("data-driftback-project-id"),o=r.getAttribute("data-driftback-email"),e={};for(const t of Array.from(r.attributes)){if(!t.name.startsWith("data-driftback-metadata-"))continue;const s=t.name.slice(24);e[s]=n(t.value)}return console.log(">>> metadata",e),{projectId:i,email:o,metadata:e}}async function g(n,r){try{const a=p(n,r);return(await(await fetch(a)).json()).survey_ids[0]||null}catch{return null}}function y(n,r){const o=t=>{const s=Math.max(120,Math.min(t|0,Math.floor(window.innerHeight*.9)));n.style.height=s+"px",r.style.height="100%"};n.style.transition="height 100ms ease";function e(t){if(t.origin!==c)return;const s=t.data||{};if(s.type==="driftback:resize"&&typeof s.height=="number"&&o(s.height),s.type==="driftback:close"){n.remove();return}}window.addEventListener("message",e)}function I(n,r,a,i){if(document.getElementById("driftback-survey-root"))return;const o=document.createElement("div");o.id="driftback-survey-root",Object.assign(o.style,{position:"fixed",inset:"auto 16px 16px auto",width:"360px",height:"0px",zIndex:5e4,boxShadow:"rgba(0,0,0,0.2) 0 18px 50px -10px",borderRadius:"16px"});const e=document.createElement("iframe");e.title="Survey",e.src=h(n,r,a,i),e.width=String(360),e.height=String(0),e.allow="clipboard-write;",Object.assign(e.style,{border:"none",width:"100%",height:"100%",display:"block"});const t=document.createElement("button");t.type="button",t.setAttribute("aria-label","Dismiss survey"),t.textContent="Ã—",Object.assign(t.style,{position:"absolute",top:"6px",right:"10px",fontSize:"24px",lineHeight:"1",border:"none",background:"transparent",cursor:"pointer",color:"#a8a29e",zIndex:2}),t.addEventListener("click",()=>{console.log(">>> sending close message of driftback:dismiss"),e.contentWindow.postMessage({type:"driftback:dismiss"},c),setTimeout(()=>o.remove(),150)},{passive:!0}),o.appendChild(e),o.appendChild(t),document.body.appendChild(o),y(o,e)}function l(){location.href!==m&&(m=location.href,d().catch(()=>{})),setTimeout(l,2e3)}async function d(){const{projectId:n,email:r,metadata:a}=b();if(!n)return;console.log(">>> projectId: ",n);const i=await g(n,r);i&&(console.log(">>> surveyId: ",i),I(n,i,r,a))}typeof window<"u"&&(window.DriftbackSurvey=Object.assign(window.DriftbackSurvey||{},{mount:d}));let m=location.href;return d(),l(),console.log("mounted"),u.mount=d,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),u})({});
